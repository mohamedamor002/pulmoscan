{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Link,useLocation}from'react-router-dom';import axios from'axios';import{DocumentTextIcon,ExclamationCircleIcon,TrashIcon,XMarkIcon}from'@heroicons/react/24/outline';import{useAuth}from'../contexts/AuthContext';import{useTheme}from'../contexts/ThemeContext';import{ROLES}from'../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ResultsPage=()=>{var _location$state;const location=useLocation();const[results,setResults]=useState([]);const[isLoading,setIsLoading]=useState(true);const[error,setError]=useState(null);const[showDeleteModal,setShowDeleteModal]=useState(false);const[scanToDelete,setScanToDelete]=useState(null);const[deleteSuccess,setDeleteSuccess]=useState(((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.deleteSuccess)||'');const{user}=useAuth();const{darkMode}=useTheme();// Clear the location state after displaying a success message\nuseEffect(()=>{var _location$state2;if((_location$state2=location.state)!==null&&_location$state2!==void 0&&_location$state2.deleteSuccess){// Clear the success message after 3 seconds\nconst timer=setTimeout(()=>{setDeleteSuccess('');// Clear the state from the location to avoid showing the message on refresh\nwindow.history.replaceState({},document.title);},3000);return()=>clearTimeout(timer);}},[location.state]);const fetchResults=async()=>{try{setIsLoading(true);// Use the user-specific endpoint for doctors and the global endpoint for admins/superadmins\nconst endpoint=user.role===ROLES.ADMIN||user.role===ROLES.SUPERADMIN?'/api/results':'/api/results/user';const response=await axios.get(endpoint);// Sort by timestamp, newest first\nconst sortedResults=response.data.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));// Debug log to see what data we're getting\nconsole.log('Results data:',sortedResults);setResults(sortedResults);setIsLoading(false);}catch(error){console.error('Error fetching results:',error);setError('Failed to load results. Please try again later.');setIsLoading(false);}};useEffect(()=>{fetchResults();},[user.role]);// Check if the current user can delete a specific scan\nconst canDeleteScan=scan=>{// Extract owner username from case name (if the format is username_filename)\nconst scanOwner=scan.case_name.split('_')[0];// Superadmin can delete any scan\nif(user.role===ROLES.SUPERADMIN){return true;}// Owners can always delete their own scans\nif(scanOwner===user.username){return true;}// Admins can delete scans from doctors they've created\nif(user.role===ROLES.ADMIN){// In a real implementation, this would check if the admin created the doctor\n// For now, we'll assume admins can delete any doctor's scans\nreturn true;}// By default, users can't delete other users' scans\nreturn false;};// Opens the delete confirmation modal\nconst openDeleteModal=(scan,e)=>{e.preventDefault();// Prevent navigation to scan details\ne.stopPropagation();// Prevent event bubbling\nsetScanToDelete(scan);setShowDeleteModal(true);};// Handles scan deletion\nconst handleDeleteScan=async()=>{try{await axios.delete(`/api/results/${scanToDelete.case_name}`);setResults(results.filter(r=>r.case_name!==scanToDelete.case_name));setDeleteSuccess(`Scan ${scanToDelete.case_name} has been deleted successfully.`);setScanToDelete(null);setShowDeleteModal(false);// Clear success message after 3 seconds\nsetTimeout(()=>{setDeleteSuccess('');},3000);}catch(error){console.error('Error deleting scan:',error);setError('Failed to delete scan. Please try again later.');setShowDeleteModal(false);}};// Helper function to extract a title from scan details\nconst extractTitle=scan=>{// Check if there's patient information available\nif(scan.patient_info&&scan.patient_info.description){// Limit the length of the description to avoid too long titles\nconst description=scan.patient_info.description;return description.length>100?description.substring(0,100)+'...':description;}// Fall back to extracting from details if no patient info description\nif(!scan.details)return\"No details available\";// Look for patient information in the details\nconst lines=scan.details.split('\\n');// Look for Clinical Notes section\nlet foundClinicNotes=false;for(let i=0;i<lines.length;i++){if(lines[i].includes('Clinical Notes:')){foundClinicNotes=true;// Return the clinical notes (on the next line or after the colon)\nif(lines[i].split('Clinical Notes:').length>1){const notes=lines[i].split('Clinical Notes:')[1].trim();// Limit length of long notes\nreturn notes.length>100?notes.substring(0,100)+'...':notes||\"No clinical notes available\";}else if(i+1<lines.length){const notes=lines[i+1].trim();return notes.length>100?notes.substring(0,100)+'...':notes||\"No clinical notes available\";}}}// If no clinical notes found, extract the first meaningful line\nconst titleLine=lines.find(line=>!line.startsWith('Nodule')&&!line.includes('Coordinates')&&!line.includes('Radius')&&!line.includes('Confidence')&&!line.includes('segmentation performed'));if(titleLine){return titleLine.length>100?titleLine.substring(0,100)+'...':titleLine;}return scan.details.length>100?scan.details.substring(0,100)+'...':scan.details;};// Helper function to extract patient name\nconst extractPatientName=scan=>{// Default username to use if no patient name is found\nconst defaultName=scan.case_name.split('_')[0];// First check patient_info object if available\nif(scan.patient_info&&scan.patient_info.name){return scan.patient_info.name;}// Fall back to extracting from details\nif(!scan.details)return defaultName;const lines=scan.details.split('\\n');// Look for Name: or Patient Name: in the details\nfor(let i=0;i<lines.length;i++){if(lines[i].includes('Name:')||lines[i].includes('Patient Name:')){// Extract name from current line if it's after the colon\nif(lines[i].split(':').length>1){const name=lines[i].split(':')[1].trim();return name||defaultName;}// Otherwise check the next line which might contain the name\nelse if(i+1<lines.length){return lines[i+1].trim()||defaultName;}}}// Default to the scan owner username if no patient name found\nreturn defaultName;};if(isLoading){return/*#__PURE__*/_jsxs(\"div\",{className:`text-center py-12 ${darkMode?'text-white':''}`,children:[/*#__PURE__*/_jsx(\"div\",{className:\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-indigo-600 border-r-transparent\"}),/*#__PURE__*/_jsx(\"p\",{className:`mt-4 ${darkMode?'text-gray-300':'text-gray-600'}`,children:\"Loading results...\"})]});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:`${darkMode?'bg-red-900':'bg-red-50'} p-4 rounded-md`,children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(ExclamationCircleIcon,{className:`h-5 w-5 ${darkMode?'text-red-300':'text-red-400'}`,\"aria-hidden\":\"true\"}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-3\",children:/*#__PURE__*/_jsx(\"h3\",{className:`text-sm font-medium ${darkMode?'text-red-300':'text-red-800'}`,children:error})})]})});}if(results.length===0){return/*#__PURE__*/_jsxs(\"div\",{className:`space-y-6 ${darkMode?'text-white':''}`,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:`text-2xl font-semibold ${darkMode?'text-white':'text-gray-900'}`,children:user.role===ROLES.DOCTOR?'My Results':'All Results'}),/*#__PURE__*/_jsx(Link,{to:\"/upload\",className:`px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500`,children:\"Upload New Scan\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:`${darkMode?'bg-gray-800':'bg-white'} shadow rounded-lg p-12 text-center`,children:[/*#__PURE__*/_jsx(DocumentTextIcon,{className:`mx-auto h-12 w-12 ${darkMode?'text-gray-500':'text-gray-400'}`}),/*#__PURE__*/_jsx(\"h3\",{className:`mt-2 text-lg font-medium ${darkMode?'text-white':'text-gray-900'}`,children:\"No results found\"}),/*#__PURE__*/_jsx(\"p\",{className:`mt-1 ${darkMode?'text-gray-300':'text-gray-500'}`,children:\"Upload a CT scan to get started.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6\",children:/*#__PURE__*/_jsx(Link,{to:\"/upload\",className:\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\",children:\"Upload CT Scan\"})})]})]});}return/*#__PURE__*/_jsxs(\"div\",{className:`space-y-6 ${darkMode?'text-white':''}`,children:[deleteSuccess&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative\",role:\"alert\",children:/*#__PURE__*/_jsx(\"span\",{className:\"block sm:inline\",children:deleteSuccess})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:`text-2xl font-semibold ${darkMode?'text-white':'text-gray-900'}`,children:user.role===ROLES.DOCTOR?'My Results':'All Results'}),/*#__PURE__*/_jsx(\"p\",{className:`text-sm ${darkMode?'text-gray-300':'text-gray-500'} mt-1`,children:user.role===ROLES.DOCTOR?'You can view and manage the CT scan results you have uploaded.':'As an administrator, you can view and manage CT scan results from all users.'})]}),/*#__PURE__*/_jsx(Link,{to:\"/upload\",className:\"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\",children:\"Upload New Scan\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\",children:results.map(result=>{// Extract owner username from case name (if the format is username_filename)\nconst scanOwner=result.case_name.split('_')[0];const isOwn=scanOwner===user.username;const canDelete=canDeleteScan(result);const scanTitle=extractTitle(result);const patientName=extractPatientName(result);const formattedDate=new Date(result.timestamp).toLocaleString();// Create direct image URL without token\nconst imageUrl=`/api/results/${result.case_name}/image`;return/*#__PURE__*/_jsxs(\"div\",{className:`${darkMode?'bg-gray-800':'bg-white'} rounded-lg shadow overflow-hidden flex flex-col h-full`,children:[/*#__PURE__*/_jsxs(Link,{to:`/results/${result.case_name}`,className:\"block overflow-hidden h-48 relative\",children:[/*#__PURE__*/_jsx(\"img\",{src:imageUrl,alt:`Scan ${result.case_name}`,className:\"w-full h-full object-cover transition-transform duration-300 hover:scale-105\",onError:e=>{console.log(`Image failed to load for ${result.case_name}`);// Just hide the image on error\ne.target.style.display='none';}}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute top-2 right-2\",children:[!isOwn&&/*#__PURE__*/_jsxs(\"span\",{className:`px-2 py-0.5 text-xs font-semibold rounded-full ${darkMode?'bg-purple-900 text-purple-100':'bg-purple-100 text-purple-800'}`,children:[\"Dr. \",scanOwner]}),isOwn&&/*#__PURE__*/_jsx(\"span\",{className:`px-2 py-0.5 text-xs font-semibold rounded-full ${darkMode?'bg-blue-900 text-blue-100':'bg-blue-100 text-blue-800'}`,children:\"Your Scan\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 flex-grow flex flex-col\",children:[/*#__PURE__*/_jsx(Link,{to:`/results/${result.case_name}`,className:\"block\",children:/*#__PURE__*/_jsx(\"h3\",{className:`text-lg font-semibold mb-2 ${darkMode?'text-white':'text-gray-900'} hover:text-indigo-600`,children:scanTitle||'No clinical notes available'})}),/*#__PURE__*/_jsx(\"div\",{className:`flex-grow ${result.patient_info?'mb-2':''}`}),/*#__PURE__*/_jsxs(\"div\",{className:`flex items-center mt-auto pt-3 ${darkMode?'border-gray-700':'border-gray-200'} border-t`,children:[/*#__PURE__*/_jsx(\"div\",{className:`p-2 rounded-md mr-2 ${darkMode?'bg-gray-700':'bg-gray-100'}`,children:/*#__PURE__*/_jsx(DocumentTextIcon,{className:`h-5 w-5 ${darkMode?'text-gray-300':'text-gray-600'}`})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow\",children:[/*#__PURE__*/_jsxs(\"p\",{className:`text-sm font-medium ${darkMode?'text-gray-300':'text-gray-900'}`,children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Patient:\"}),\" \",patientName]}),result.patient_info&&result.patient_info.age&&/*#__PURE__*/_jsxs(\"p\",{className:`text-sm ${darkMode?'text-gray-400':'text-gray-600'}`,children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Age:\"}),\" \",result.patient_info.age]}),/*#__PURE__*/_jsx(\"p\",{className:`text-xs mt-1 ${darkMode?'text-gray-400':'text-gray-500'}`,children:formattedDate})]}),canDelete&&/*#__PURE__*/_jsx(\"button\",{onClick:e=>openDeleteModal(result,e),className:`p-1.5 rounded-full ${darkMode?'text-gray-400 hover:bg-gray-700 hover:text-red-300':'text-gray-400 hover:bg-gray-100 hover:text-red-600'}`,title:\"Delete scan\",children:/*#__PURE__*/_jsx(TrashIcon,{className:\"h-5 w-5\"})})]})]})]},result.case_name);})}),showDeleteModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-10 overflow-y-auto\",\"aria-labelledby\":\"modal-title\",role:\"dialog\",\"aria-modal\":\"true\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\",\"aria-hidden\":\"true\",onClick:()=>setShowDeleteModal(false)}),/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline-block sm:align-middle sm:h-screen\",\"aria-hidden\":\"true\",children:\"\\u200B\"}),/*#__PURE__*/_jsxs(\"div\",{className:`inline-block align-bottom ${darkMode?'bg-gray-800':'bg-white'} rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full`,children:[/*#__PURE__*/_jsx(\"div\",{className:`${darkMode?'bg-gray-800':'bg-white'} px-4 pt-5 pb-4 sm:p-6 sm:pb-4`,children:/*#__PURE__*/_jsxs(\"div\",{className:\"sm:flex sm:items-start\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10\",children:/*#__PURE__*/_jsx(ExclamationCircleIcon,{className:\"h-6 w-6 text-red-600\",\"aria-hidden\":\"true\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left\",children:[/*#__PURE__*/_jsx(\"h3\",{className:`text-lg leading-6 font-medium ${darkMode?'text-white':'text-gray-900'}`,id:\"modal-title\",children:\"Delete Scan\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsxs(\"p\",{className:`text-sm ${darkMode?'text-gray-300':'text-gray-500'}`,children:[\"Are you sure you want to delete the scan \\\"\",scanToDelete===null||scanToDelete===void 0?void 0:scanToDelete.case_name,\"\\\"? This action cannot be undone.\"]})})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:`${darkMode?'bg-gray-800':'bg-gray-50'} px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse`,children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm\",onClick:handleDeleteScan,children:\"Delete\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:`mt-3 w-full inline-flex justify-center rounded-md border ${darkMode?'border-gray-600 bg-gray-700 text-gray-300 hover:bg-gray-600':'border-gray-300 bg-white text-gray-700 hover:bg-gray-50'} shadow-sm px-4 py-2 text-base font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm`,onClick:()=>setShowDeleteModal(false),children:\"Cancel\"})]})]})]})})]});};export default ResultsPage;","map":{"version":3,"names":["React","useState","useEffect","Link","useLocation","axios","DocumentTextIcon","ExclamationCircleIcon","TrashIcon","XMarkIcon","useAuth","useTheme","ROLES","jsx","_jsx","jsxs","_jsxs","ResultsPage","_location$state","location","results","setResults","isLoading","setIsLoading","error","setError","showDeleteModal","setShowDeleteModal","scanToDelete","setScanToDelete","deleteSuccess","setDeleteSuccess","state","user","darkMode","_location$state2","timer","setTimeout","window","history","replaceState","document","title","clearTimeout","fetchResults","endpoint","role","ADMIN","SUPERADMIN","response","get","sortedResults","data","sort","a","b","Date","timestamp","console","log","canDeleteScan","scan","scanOwner","case_name","split","username","openDeleteModal","e","preventDefault","stopPropagation","handleDeleteScan","delete","filter","r","extractTitle","patient_info","description","length","substring","details","lines","foundClinicNotes","i","includes","notes","trim","titleLine","find","line","startsWith","extractPatientName","defaultName","name","className","children","DOCTOR","to","map","result","isOwn","canDelete","scanTitle","patientName","formattedDate","toLocaleString","imageUrl","src","alt","onError","target","style","display","age","onClick","id","type"],"sources":["D:/Segmentation/pipeline/webapp/static/src/pages/ResultsPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Link, useLocation } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { DocumentTextIcon, ExclamationCircleIcon, TrashIcon, XMarkIcon } from '@heroicons/react/24/outline';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { useTheme } from '../contexts/ThemeContext';\r\nimport { ROLES } from '../contexts/AuthContext';\r\n\r\nconst ResultsPage = () => {\r\n  const location = useLocation();\r\n  const [results, setResults] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [scanToDelete, setScanToDelete] = useState(null);\r\n  const [deleteSuccess, setDeleteSuccess] = useState(location.state?.deleteSuccess || '');\r\n  const { user } = useAuth();\r\n  const { darkMode } = useTheme();\r\n\r\n  // Clear the location state after displaying a success message\r\n  useEffect(() => {\r\n    if (location.state?.deleteSuccess) {\r\n      // Clear the success message after 3 seconds\r\n      const timer = setTimeout(() => {\r\n        setDeleteSuccess('');\r\n        // Clear the state from the location to avoid showing the message on refresh\r\n        window.history.replaceState({}, document.title);\r\n      }, 3000);\r\n      \r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [location.state]);\r\n\r\n  const fetchResults = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      // Use the user-specific endpoint for doctors and the global endpoint for admins/superadmins\r\n      const endpoint = (user.role === ROLES.ADMIN || user.role === ROLES.SUPERADMIN) \r\n        ? '/api/results' \r\n        : '/api/results/user';\r\n      const response = await axios.get(endpoint);\r\n      \r\n      // Sort by timestamp, newest first\r\n      const sortedResults = response.data.sort((a, b) => \r\n        new Date(b.timestamp) - new Date(a.timestamp)\r\n      );\r\n      \r\n      // Debug log to see what data we're getting\r\n      console.log('Results data:', sortedResults);\r\n      \r\n      setResults(sortedResults);\r\n      setIsLoading(false);\r\n    } catch (error) {\r\n      console.error('Error fetching results:', error);\r\n      setError('Failed to load results. Please try again later.');\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchResults();\r\n  }, [user.role]);\r\n\r\n  // Check if the current user can delete a specific scan\r\n  const canDeleteScan = (scan) => {\r\n    // Extract owner username from case name (if the format is username_filename)\r\n    const scanOwner = scan.case_name.split('_')[0];\r\n    \r\n    // Superadmin can delete any scan\r\n    if (user.role === ROLES.SUPERADMIN) {\r\n      return true;\r\n    }\r\n    \r\n    // Owners can always delete their own scans\r\n    if (scanOwner === user.username) {\r\n      return true;\r\n    }\r\n    \r\n    // Admins can delete scans from doctors they've created\r\n    if (user.role === ROLES.ADMIN) {\r\n      // In a real implementation, this would check if the admin created the doctor\r\n      // For now, we'll assume admins can delete any doctor's scans\r\n      return true;\r\n    }\r\n    \r\n    // By default, users can't delete other users' scans\r\n    return false;\r\n  };\r\n\r\n  // Opens the delete confirmation modal\r\n  const openDeleteModal = (scan, e) => {\r\n    e.preventDefault(); // Prevent navigation to scan details\r\n    e.stopPropagation(); // Prevent event bubbling\r\n    setScanToDelete(scan);\r\n    setShowDeleteModal(true);\r\n  };\r\n\r\n  // Handles scan deletion\r\n  const handleDeleteScan = async () => {\r\n    try {\r\n      await axios.delete(`/api/results/${scanToDelete.case_name}`);\r\n      setResults(results.filter(r => r.case_name !== scanToDelete.case_name));\r\n      setDeleteSuccess(`Scan ${scanToDelete.case_name} has been deleted successfully.`);\r\n      setScanToDelete(null);\r\n      setShowDeleteModal(false);\r\n      \r\n      // Clear success message after 3 seconds\r\n      setTimeout(() => {\r\n        setDeleteSuccess('');\r\n      }, 3000);\r\n    } catch (error) {\r\n      console.error('Error deleting scan:', error);\r\n      setError('Failed to delete scan. Please try again later.');\r\n      setShowDeleteModal(false);\r\n    }\r\n  };\r\n\r\n  // Helper function to extract a title from scan details\r\n  const extractTitle = (scan) => {\r\n    // Check if there's patient information available\r\n    if (scan.patient_info && scan.patient_info.description) {\r\n      // Limit the length of the description to avoid too long titles\r\n      const description = scan.patient_info.description;\r\n      return description.length > 100 ? description.substring(0, 100) + '...' : description;\r\n    }\r\n    \r\n    // Fall back to extracting from details if no patient info description\r\n    if (!scan.details) return \"No details available\";\r\n    \r\n    // Look for patient information in the details\r\n    const lines = scan.details.split('\\n');\r\n    \r\n    // Look for Clinical Notes section\r\n    let foundClinicNotes = false;\r\n    for (let i = 0; i < lines.length; i++) {\r\n      if (lines[i].includes('Clinical Notes:')) {\r\n        foundClinicNotes = true;\r\n        // Return the clinical notes (on the next line or after the colon)\r\n        if (lines[i].split('Clinical Notes:').length > 1) {\r\n          const notes = lines[i].split('Clinical Notes:')[1].trim();\r\n          // Limit length of long notes\r\n          return notes.length > 100 ? notes.substring(0, 100) + '...' : notes || \"No clinical notes available\";\r\n        } else if (i + 1 < lines.length) {\r\n          const notes = lines[i + 1].trim();\r\n          return notes.length > 100 ? notes.substring(0, 100) + '...' : notes || \"No clinical notes available\";\r\n        }\r\n      }\r\n    }\r\n    \r\n    // If no clinical notes found, extract the first meaningful line\r\n    const titleLine = lines.find(line => \r\n      !line.startsWith('Nodule') && \r\n      !line.includes('Coordinates') && \r\n      !line.includes('Radius') && \r\n      !line.includes('Confidence') &&\r\n      !line.includes('segmentation performed')\r\n    );\r\n    \r\n    if (titleLine) {\r\n      return titleLine.length > 100 ? titleLine.substring(0, 100) + '...' : titleLine;\r\n    }\r\n    \r\n    return scan.details.length > 100 ? scan.details.substring(0, 100) + '...' : scan.details;\r\n  };\r\n\r\n  // Helper function to extract patient name\r\n  const extractPatientName = (scan) => {\r\n    // Default username to use if no patient name is found\r\n    const defaultName = scan.case_name.split('_')[0];\r\n    \r\n    // First check patient_info object if available\r\n    if (scan.patient_info && scan.patient_info.name) {\r\n      return scan.patient_info.name;\r\n    }\r\n    \r\n    // Fall back to extracting from details\r\n    if (!scan.details) return defaultName;\r\n    \r\n    const lines = scan.details.split('\\n');\r\n    \r\n    // Look for Name: or Patient Name: in the details\r\n    for (let i = 0; i < lines.length; i++) {\r\n      if (lines[i].includes('Name:') || lines[i].includes('Patient Name:')) {\r\n        // Extract name from current line if it's after the colon\r\n        if (lines[i].split(':').length > 1) {\r\n          const name = lines[i].split(':')[1].trim();\r\n          return name || defaultName;\r\n        } \r\n        // Otherwise check the next line which might contain the name\r\n        else if (i + 1 < lines.length) {\r\n          return lines[i + 1].trim() || defaultName;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Default to the scan owner username if no patient name found\r\n    return defaultName;\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className={`text-center py-12 ${darkMode ? 'text-white' : ''}`}>\r\n        <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-indigo-600 border-r-transparent\"></div>\r\n        <p className={`mt-4 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Loading results...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className={`${darkMode ? 'bg-red-900' : 'bg-red-50'} p-4 rounded-md`}>\r\n        <div className=\"flex\">\r\n          <ExclamationCircleIcon className={`h-5 w-5 ${darkMode ? 'text-red-300' : 'text-red-400'}`} aria-hidden=\"true\" />\r\n          <div className=\"ml-3\">\r\n            <h3 className={`text-sm font-medium ${darkMode ? 'text-red-300' : 'text-red-800'}`}>{error}</h3>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (results.length === 0) {\r\n    return (\r\n      <div className={`space-y-6 ${darkMode ? 'text-white' : ''}`}>\r\n        <div className=\"flex justify-between items-center\">\r\n          <h1 className={`text-2xl font-semibold ${darkMode ? 'text-white' : 'text-gray-900'}`}>\r\n            {user.role === ROLES.DOCTOR ? 'My Results' : 'All Results'}\r\n          </h1>\r\n          <Link \r\n            to=\"/upload\" \r\n            className={`px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500`}\r\n          >\r\n            Upload New Scan\r\n          </Link>\r\n        </div>\r\n        \r\n        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} shadow rounded-lg p-12 text-center`}>\r\n          <DocumentTextIcon className={`mx-auto h-12 w-12 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          <h3 className={`mt-2 text-lg font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>No results found</h3>\r\n          <p className={`mt-1 ${darkMode ? 'text-gray-300' : 'text-gray-500'}`}>Upload a CT scan to get started.</p>\r\n          <div className=\"mt-6\">\r\n            <Link \r\n              to=\"/upload\"\r\n              className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\r\n            >\r\n              Upload CT Scan\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`space-y-6 ${darkMode ? 'text-white' : ''}`}>\r\n      {deleteSuccess && (\r\n        <div className=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative\" role=\"alert\">\r\n          <span className=\"block sm:inline\">{deleteSuccess}</span>\r\n        </div>\r\n      )}\r\n      \r\n      <div className=\"flex justify-between items-center\">\r\n        <div>\r\n          <h1 className={`text-2xl font-semibold ${darkMode ? 'text-white' : 'text-gray-900'}`}>\r\n            {user.role === ROLES.DOCTOR ? 'My Results' : 'All Results'}\r\n          </h1>\r\n          <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-500'} mt-1`}>\r\n            {user.role === ROLES.DOCTOR \r\n              ? 'You can view and manage the CT scan results you have uploaded.' \r\n              : 'As an administrator, you can view and manage CT scan results from all users.'}\r\n          </p>\r\n        </div>\r\n        <Link \r\n          to=\"/upload\" \r\n          className=\"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\r\n        >\r\n          Upload New Scan\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Blog-style grid layout for scan results */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n        {results.map((result) => {\r\n          // Extract owner username from case name (if the format is username_filename)\r\n          const scanOwner = result.case_name.split('_')[0];\r\n          const isOwn = scanOwner === user.username;\r\n          const canDelete = canDeleteScan(result);\r\n          const scanTitle = extractTitle(result);\r\n          const patientName = extractPatientName(result);\r\n          const formattedDate = new Date(result.timestamp).toLocaleString();\r\n          \r\n          // Create direct image URL without token\r\n          const imageUrl = `/api/results/${result.case_name}/image`;\r\n          \r\n          return (\r\n            <div \r\n              key={result.case_name} \r\n              className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow overflow-hidden flex flex-col h-full`}\r\n            >\r\n              {/* Scan Image */}\r\n              <Link to={`/results/${result.case_name}`} className=\"block overflow-hidden h-48 relative\">\r\n                <img \r\n                  src={imageUrl} \r\n                  alt={`Scan ${result.case_name}`} \r\n                  className=\"w-full h-full object-cover transition-transform duration-300 hover:scale-105\"\r\n                  onError={(e) => {\r\n                    console.log(`Image failed to load for ${result.case_name}`);\r\n                    // Just hide the image on error\r\n                    e.target.style.display = 'none';\r\n                  }}\r\n                />\r\n                \r\n                {/* Status indicator overlay */}\r\n                <div className=\"absolute top-2 right-2\">\r\n                  {!isOwn && (\r\n                    <span className={`px-2 py-0.5 text-xs font-semibold rounded-full ${\r\n                      darkMode \r\n                        ? 'bg-purple-900 text-purple-100' \r\n                        : 'bg-purple-100 text-purple-800'\r\n                    }`}>\r\n                      Dr. {scanOwner}\r\n                    </span>\r\n                  )}\r\n                  {isOwn && (\r\n                    <span className={`px-2 py-0.5 text-xs font-semibold rounded-full ${\r\n                      darkMode \r\n                        ? 'bg-blue-900 text-blue-100' \r\n                        : 'bg-blue-100 text-blue-800'\r\n                    }`}>\r\n                      Your Scan\r\n                    </span>\r\n                  )}\r\n                </div>\r\n              </Link>\r\n              \r\n              {/* Content */}\r\n              <div className=\"p-4 flex-grow flex flex-col\">\r\n                <Link to={`/results/${result.case_name}`} className=\"block\">\r\n                  <h3 className={`text-lg font-semibold mb-2 ${darkMode ? 'text-white' : 'text-gray-900'} hover:text-indigo-600`}>\r\n                    {scanTitle || 'No clinical notes available'}\r\n                  </h3>\r\n                </Link>\r\n                \r\n                <div className={`flex-grow ${result.patient_info ? 'mb-2' : ''}`}></div>\r\n                \r\n                <div className={`flex items-center mt-auto pt-3 ${darkMode ? 'border-gray-700' : 'border-gray-200'} border-t`}>\r\n                  <div className={`p-2 rounded-md mr-2 ${darkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>\r\n                    <DocumentTextIcon className={`h-5 w-5 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`} />\r\n                  </div>\r\n                  <div className=\"flex-grow\">\r\n                    <p className={`text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-900'}`}>\r\n                      <span className=\"font-semibold\">Patient:</span> {patientName}\r\n                    </p>\r\n                    {result.patient_info && result.patient_info.age && (\r\n                      <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                        <span className=\"font-semibold\">Age:</span> {result.patient_info.age}\r\n                      </p>\r\n                    )}\r\n                    <p className={`text-xs mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                      {formattedDate}\r\n                    </p>\r\n                  </div>\r\n                  \r\n                  {canDelete && (\r\n                    <button\r\n                      onClick={(e) => openDeleteModal(result, e)}\r\n                      className={`p-1.5 rounded-full ${\r\n                        darkMode \r\n                          ? 'text-gray-400 hover:bg-gray-700 hover:text-red-300' \r\n                          : 'text-gray-400 hover:bg-gray-100 hover:text-red-600'\r\n                      }`}\r\n                      title=\"Delete scan\"\r\n                    >\r\n                      <TrashIcon className=\"h-5 w-5\" />\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Delete confirmation modal */}\r\n      {showDeleteModal && (\r\n        <div className=\"fixed inset-0 z-10 overflow-y-auto\" aria-labelledby=\"modal-title\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\">\r\n            <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\" aria-hidden=\"true\" onClick={() => setShowDeleteModal(false)}></div>\r\n            <span className=\"hidden sm:inline-block sm:align-middle sm:h-screen\" aria-hidden=\"true\">&#8203;</span>\r\n            <div className={`inline-block align-bottom ${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full`}>\r\n              <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} px-4 pt-5 pb-4 sm:p-6 sm:pb-4`}>\r\n                <div className=\"sm:flex sm:items-start\">\r\n                  <div className=\"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10\">\r\n                    <ExclamationCircleIcon className=\"h-6 w-6 text-red-600\" aria-hidden=\"true\" />\r\n                  </div>\r\n                  <div className=\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left\">\r\n                    <h3 className={`text-lg leading-6 font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`} id=\"modal-title\">\r\n                      Delete Scan\r\n                    </h3>\r\n                    <div className=\"mt-2\">\r\n                      <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-500'}`}>\r\n                        Are you sure you want to delete the scan \"{scanToDelete?.case_name}\"? This action cannot be undone.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className={`${darkMode ? 'bg-gray-800' : 'bg-gray-50'} px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse`}>\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm\"\r\n                  onClick={handleDeleteScan}\r\n                >\r\n                  Delete\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  className={`mt-3 w-full inline-flex justify-center rounded-md border ${darkMode ? 'border-gray-600 bg-gray-700 text-gray-300 hover:bg-gray-600' : 'border-gray-300 bg-white text-gray-700 hover:bg-gray-50'} shadow-sm px-4 py-2 text-base font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm`}\r\n                  onClick={() => setShowDeleteModal(false)}\r\n                >\r\n                  Cancel\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResultsPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}