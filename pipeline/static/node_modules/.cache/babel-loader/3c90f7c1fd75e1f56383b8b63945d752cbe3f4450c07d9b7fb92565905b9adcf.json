{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,Link,useNavigate}from'react-router-dom';import axios from'axios';import{ExclamationCircleIcon,ArrowLeftIcon,UserCircleIcon,TrashIcon}from'@heroicons/react/24/outline';import{useAuth,ROLES}from'../contexts/AuthContext';import{useTheme}from'../contexts/ThemeContext';import InteractiveViewer from'../components/InteractiveViewer';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ResultDetailPage=()=>{const{caseId}=useParams();const[result,setResult]=useState(null);const[isLoading,setIsLoading]=useState(true);const[error,setError]=useState(null);const[showDeleteModal,setShowDeleteModal]=useState(false);const[selectedNoduleId,setSelectedNoduleId]=useState(null);const{user}=useAuth();const{darkMode}=useTheme();const navigate=useNavigate();// Extract owner username from case ID (if the format is username_filename)\nconst ownerUsername=caseId.split('_')[0];const isOwner=user.username===ownerUsername;const isAdmin=user.role===ROLES.ADMIN;const isSuperAdmin=user.role===ROLES.SUPERADMIN;// Check if the current user can delete this scan\nconst canDelete=()=>{// Superadmin can delete any scan\nif(isSuperAdmin){return true;}// Owner can delete their own scan\nif(isOwner){return true;}// Admin can delete doctors' scans (in a real implementation, you'd check if the admin created the doctor)\nif(isAdmin){return true;}return false;};useEffect(()=>{const fetchResultDetails=async()=>{try{setIsLoading(true);const response=await axios.get(`/api/results/${caseId}`);setResult(response.data);// Get the JWT token to use for image access\nconst token=localStorage.getItem('token');if(token&&response.data.image_url){// Ensure the image URL has the correct format and token\nconst baseUrl=response.data.image_url.split('?')[0];// Remove any existing query params\nresponse.data.image_url=`${baseUrl}?token=${token}`;// Log success for debugging\nconsole.log(\"Image URL set with authentication token\");}setIsLoading(false);}catch(error){console.error('Error fetching result details:',error);// Handle 403 Forbidden errors with a specific message\nif(error.response&&error.response.status===403){setError('You do not have permission to view this scan. You can only view scans you have uploaded.');}else{setError('Failed to load result details. Please try again later.');}setIsLoading(false);}};fetchResultDetails();},[caseId]);// Handle scan deletion\nconst handleDeleteScan=async()=>{try{await axios.delete(`/api/results/${caseId}`);// Redirect to results page after successful deletion\nnavigate('/results',{state:{deleteSuccess:`Scan ${caseId} has been deleted successfully.`}});}catch(error){console.error('Error deleting scan:',error);setError('Failed to delete scan. Please try again later.');setShowDeleteModal(false);}};// Handle nodule selection\nconst handleNoduleClick=noduleId=>{setSelectedNoduleId(noduleId);};if(isLoading){return/*#__PURE__*/_jsxs(\"div\",{className:`text-center py-12 ${darkMode?'text-white':''}`,children:[/*#__PURE__*/_jsx(\"div\",{className:\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-indigo-600 border-r-transparent\"}),/*#__PURE__*/_jsx(\"p\",{className:`mt-4 ${darkMode?'text-gray-300':'text-gray-600'}`,children:\"Loading result details...\"})]});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:`${darkMode?'bg-red-900':'bg-red-50'} p-4 rounded-md`,children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(ExclamationCircleIcon,{className:`h-5 w-5 ${darkMode?'text-red-300':'text-red-400'}`,\"aria-hidden\":\"true\"}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-3\",children:/*#__PURE__*/_jsx(\"h3\",{className:`text-sm font-medium ${darkMode?'text-red-300':'text-red-800'}`,children:error})})]})});}if(!result){return/*#__PURE__*/_jsxs(\"div\",{className:`text-center py-12 ${darkMode?'text-white':''}`,children:[/*#__PURE__*/_jsx(\"p\",{className:`${darkMode?'text-gray-300':'text-gray-600'}`,children:\"No result found for this case ID.\"}),/*#__PURE__*/_jsx(Link,{to:\"/results\",className:`mt-4 inline-block ${darkMode?'text-indigo-400 hover:text-indigo-300':'text-indigo-600 hover:text-indigo-500'}`,children:\"Back to all results\"})]});}// Format the timestamp\nconst formattedDate=new Date(result.timestamp).toLocaleString();// Parse details if available\nconst hasNodules=result.details&&!result.details.includes('No nodules detected');// Extract nodule information if available\nconst nodules=[];if(hasNodules&&result.details){const lines=result.details.split('\\n');let currentNodule=null;for(const line of lines){// Skip segmentation information line\nif(line.includes('Nodule segmentation performed:')){continue;}if(line.startsWith('Nodule ')){if(currentNodule){nodules.push(currentNodule);}currentNodule={id:line.replace(':','').trim(),coordinates:'',radius:'',confidence:'',merged:''};}else if(currentNodule){if(line.includes('Coordinates')){currentNodule.coordinates=line.split(':')[1].trim();}else if(line.includes('Radius')){currentNodule.radius=line.split(':')[1].trim();}else if(line.includes('Confidence')){currentNodule.confidence=line.split(':')[1].trim();}else if(line.includes('Merged from')){currentNodule.merged=line.split(':')[1].trim();}}}// Add the last nodule\nif(currentNodule){nodules.push(currentNodule);}}// Correctly display the count of nodules\nconst noduleCount=nodules.length;const noduleSummary=hasNodules?`${noduleCount} potential ${noduleCount===1?'nodule':'nodules'} detected in this scan`:'No potential nodules detected in this scan';return/*#__PURE__*/_jsxs(\"div\",{className:`space-y-6 ${darkMode?'text-white':''}`,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(Link,{to:\"/results\",className:`${darkMode?'text-gray-300 hover:text-gray-100':'text-gray-500 hover:text-gray-700'}`,children:/*#__PURE__*/_jsx(ArrowLeftIcon,{className:\"h-5 w-5\"})}),/*#__PURE__*/_jsxs(\"h1\",{className:`text-2xl font-semibold ${darkMode?'text-white':'text-gray-900'}`,children:[\"Result: \",result.case_name]}),isAdmin&&!isOwner?/*#__PURE__*/_jsxs(\"span\",{className:`ml-2 px-3 py-1 inline-flex items-center text-xs font-medium rounded-full ${darkMode?'bg-purple-900 text-purple-100':'bg-purple-100 text-purple-800'}`,children:[/*#__PURE__*/_jsx(UserCircleIcon,{className:\"h-3 w-3 mr-1\"}),\"Dr. \",ownerUsername,\"'s scan\"]}):/*#__PURE__*/_jsxs(\"span\",{className:`ml-2 px-3 py-1 inline-flex items-center text-xs font-medium rounded-full ${darkMode?'bg-blue-900 text-blue-100':'bg-blue-100 text-blue-800'}`,children:[/*#__PURE__*/_jsx(UserCircleIcon,{className:\"h-3 w-3 mr-1\"}),\"Your scan\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"span\",{className:`text-sm ${darkMode?'text-gray-300':'text-gray-500'}`,children:[\"Processed on \",formattedDate]}),canDelete()&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowDeleteModal(true),className:`px-3 py-1.5 text-sm font-medium flex items-center rounded-md ${darkMode?'bg-red-900 text-red-100 hover:bg-red-800':'bg-red-100 text-red-800 hover:bg-red-200'}`,children:[/*#__PURE__*/_jsx(TrashIcon,{className:\"h-4 w-4 mr-1\"}),\"Delete Scan\"]})]})]}),isAdmin&&!isOwner&&/*#__PURE__*/_jsx(\"div\",{className:`${darkMode?'bg-yellow-900 border-yellow-700':'bg-yellow-50 border-yellow-400'} border-l-4 p-4`,children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(ExclamationCircleIcon,{className:`h-5 w-5 ${darkMode?'text-yellow-500':'text-yellow-400'}`,\"aria-hidden\":\"true\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-3\",children:/*#__PURE__*/_jsxs(\"p\",{className:`text-sm ${darkMode?'text-yellow-200':'text-yellow-700'}`,children:[\"You are viewing this scan as an administrator. This scan was uploaded by \",/*#__PURE__*/_jsxs(\"strong\",{children:[\"Dr. \",ownerUsername]}),\".\"]})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:`${darkMode?'bg-gray-800':'bg-white'} shadow rounded-lg overflow-hidden`,children:[/*#__PURE__*/_jsx(\"div\",{className:`px-4 py-3 border-b ${darkMode?'border-gray-700':'border-gray-200'} sm:px-6`,children:/*#__PURE__*/_jsx(\"h3\",{className:`text-lg font-medium ${darkMode?'text-white':'text-gray-900'}`,children:\"Interactive Visualization\"})}),/*#__PURE__*/_jsx(InteractiveViewer,{caseId:caseId,selectedNoduleId:selectedNoduleId})]}),/*#__PURE__*/_jsxs(\"div\",{className:`${darkMode?'bg-gray-800':'bg-white'} shadow rounded-lg overflow-hidden`,children:[/*#__PURE__*/_jsx(\"div\",{className:`px-4 py-5 border-b ${darkMode?'border-gray-700':'border-gray-200'} sm:px-6`,children:/*#__PURE__*/_jsx(\"h3\",{className:`text-lg font-medium ${darkMode?'text-white':'text-gray-900'}`,children:\"Details\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[result.patient_info&&/*#__PURE__*/_jsxs(\"div\",{className:`mb-6 p-4 rounded-md ${darkMode?'bg-gray-700':'bg-gray-50'}`,children:[/*#__PURE__*/_jsx(\"h4\",{className:`text-md font-medium ${darkMode?'text-white':'text-gray-900'} mb-2`,children:\"Patient Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:`grid grid-cols-1 md:grid-cols-2 gap-4 ${darkMode?'text-gray-300':'text-gray-700'}`,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium mb-1\",children:\"Patient Name:\"}),/*#__PURE__*/_jsx(\"p\",{children:result.patient_info.name||'Not provided'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium mb-1\",children:\"Age:\"}),/*#__PURE__*/_jsx(\"p\",{children:result.patient_info.age||'Not provided'})]}),result.patient_info.description&&/*#__PURE__*/_jsxs(\"div\",{className:\"col-span-1 md:col-span-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium mb-1\",children:\"Clinical Notes:\"}),/*#__PURE__*/_jsx(\"p\",{className:\"whitespace-pre-wrap\",children:result.patient_info.description})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-span-1 md:col-span-2 mt-2\",children:/*#__PURE__*/_jsxs(\"p\",{className:`text-xs ${darkMode?'text-gray-400':'text-gray-500'}`,children:[\"Added by: \",result.patient_info.user,\" on \",new Date(result.patient_info.timestamp).toLocaleString()]})})]})]}),hasNodules?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:`text-md font-medium ${darkMode?'text-white':'text-gray-900'}`,children:\"Summary\"}),/*#__PURE__*/_jsx(\"p\",{className:`${darkMode?'text-gray-300':'text-gray-700'}`,children:noduleSummary})]}),/*#__PURE__*/_jsx(\"h4\",{className:`text-md font-medium ${darkMode?'text-white':'text-gray-900'} mb-2`,children:\"Detected Nodules\"}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:`min-w-full divide-y ${darkMode?'divide-gray-700':'divide-gray-200'}`,children:[/*#__PURE__*/_jsx(\"thead\",{className:`${darkMode?'bg-gray-700':'bg-gray-50'}`,children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:`px-6 py-3 text-left text-xs font-medium ${darkMode?'text-gray-300':'text-gray-500'} uppercase tracking-wider`,children:\"Nodule\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:`px-6 py-3 text-left text-xs font-medium ${darkMode?'text-gray-300':'text-gray-500'} uppercase tracking-wider`,children:\"Coordinates (z,y,x)\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:`px-6 py-3 text-left text-xs font-medium ${darkMode?'text-gray-300':'text-gray-500'} uppercase tracking-wider`,children:\"Radius (mm)\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:`px-6 py-3 text-left text-xs font-medium ${darkMode?'text-gray-300':'text-gray-500'} uppercase tracking-wider`,children:\"Confidence\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:`${darkMode?'bg-gray-800 divide-y divide-gray-700':'bg-white divide-y divide-gray-200'}`,children:nodules.map((nodule,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:`${index%2===0?darkMode?'bg-gray-900':'bg-gray-50':''} \n                          cursor-pointer hover:${darkMode?'bg-gray-700':'bg-gray-100'}`,onClick:()=>handleNoduleClick(nodule.id),children:[/*#__PURE__*/_jsx(\"td\",{className:`px-6 py-4 whitespace-nowrap text-sm ${darkMode?'text-white':'text-gray-900'}`,children:nodule.id}),/*#__PURE__*/_jsx(\"td\",{className:`px-6 py-4 whitespace-nowrap text-sm ${darkMode?'text-gray-300':'text-gray-500'}`,children:nodule.coordinates}),/*#__PURE__*/_jsx(\"td\",{className:`px-6 py-4 whitespace-nowrap text-sm ${darkMode?'text-gray-300':'text-gray-500'}`,children:nodule.radius}),/*#__PURE__*/_jsx(\"td\",{className:`px-6 py-4 whitespace-nowrap text-sm ${darkMode?'text-gray-300':'text-gray-500'}`,children:nodule.confidence})]},index))})]})})]}):/*#__PURE__*/_jsx(\"div\",{className:`text-center py-8 ${darkMode?'text-gray-300':'text-gray-500'}`,children:/*#__PURE__*/_jsx(\"p\",{children:\"No nodules were detected in this scan.\"})})]})]}),showDeleteModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed z-10 inset-0 overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 transition-opacity\",\"aria-hidden\":\"true\",children:/*#__PURE__*/_jsx(\"div\",{className:`absolute inset-0 ${darkMode?'bg-gray-900':'bg-gray-500'} opacity-75`})}),/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline-block sm:align-middle sm:h-screen\",\"aria-hidden\":\"true\",children:\"\\u200B\"}),/*#__PURE__*/_jsxs(\"div\",{className:`inline-block align-bottom ${darkMode?'bg-gray-800':'bg-white'} rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full`,children:[/*#__PURE__*/_jsx(\"div\",{className:`${darkMode?'bg-gray-800':'bg-white'} px-4 pt-5 pb-4 sm:p-6 sm:pb-4`,children:/*#__PURE__*/_jsxs(\"div\",{className:\"sm:flex sm:items-start\",children:[/*#__PURE__*/_jsx(\"div\",{className:`mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full ${darkMode?'bg-red-900':'bg-red-100'} sm:mx-0 sm:h-10 sm:w-10`,children:/*#__PURE__*/_jsx(ExclamationCircleIcon,{className:`h-6 w-6 ${darkMode?'text-red-300':'text-red-600'}`,\"aria-hidden\":\"true\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left\",children:[/*#__PURE__*/_jsx(\"h3\",{className:`text-lg leading-6 font-medium ${darkMode?'text-white':'text-gray-900'}`,children:\"Delete Scan\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsxs(\"p\",{className:`text-sm ${darkMode?'text-gray-300':'text-gray-500'}`,children:[\"Are you sure you want to delete the scan \\\"\",result.case_name,\"\\\"? This action cannot be undone.\"]})})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:`${darkMode?'bg-gray-800 border-t border-gray-700':'bg-gray-50 border-t border-gray-200'} px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse`,children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleDeleteScan,className:\"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm\",children:\"Delete\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowDeleteModal(false),className:`mt-3 w-full inline-flex justify-center rounded-md border shadow-sm px-4 py-2 text-base font-medium focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm ${darkMode?'border-gray-600 bg-gray-700 text-gray-300 hover:bg-gray-600':'border-gray-300 bg-white text-gray-700 hover:bg-gray-50'}`,children:\"Cancel\"})]})]})]})})]});};export default ResultDetailPage;","map":{"version":3,"names":["React","useState","useEffect","useParams","Link","useNavigate","axios","ExclamationCircleIcon","ArrowLeftIcon","UserCircleIcon","TrashIcon","useAuth","ROLES","useTheme","InteractiveViewer","jsx","_jsx","jsxs","_jsxs","ResultDetailPage","caseId","result","setResult","isLoading","setIsLoading","error","setError","showDeleteModal","setShowDeleteModal","selectedNoduleId","setSelectedNoduleId","user","darkMode","navigate","ownerUsername","split","isOwner","username","isAdmin","role","ADMIN","isSuperAdmin","SUPERADMIN","canDelete","fetchResultDetails","response","get","data","token","localStorage","getItem","image_url","baseUrl","console","log","status","handleDeleteScan","delete","state","deleteSuccess","handleNoduleClick","noduleId","className","children","to","formattedDate","Date","timestamp","toLocaleString","hasNodules","details","includes","nodules","lines","currentNodule","line","startsWith","push","id","replace","trim","coordinates","radius","confidence","merged","noduleCount","length","noduleSummary","case_name","onClick","patient_info","name","age","description","scope","map","nodule","index","type"],"sources":["C:/Users/kouss/Desktop/Cursor/Segmentation/pipeline/webapp/static/src/pages/ResultDetailPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams, Link, useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { \r\n  ExclamationCircleIcon, \r\n  ArrowLeftIcon, \r\n  UserCircleIcon,\r\n  TrashIcon \r\n} from '@heroicons/react/24/outline';\r\nimport { useAuth, ROLES } from '../contexts/AuthContext';\r\nimport { useTheme } from '../contexts/ThemeContext';\r\nimport InteractiveViewer from '../components/InteractiveViewer';\r\n\r\nconst ResultDetailPage = () => {\r\n  const { caseId } = useParams();\r\n  const [result, setResult] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [selectedNoduleId, setSelectedNoduleId] = useState(null);\r\n  const { user } = useAuth();\r\n  const { darkMode } = useTheme();\r\n  const navigate = useNavigate();\r\n\r\n  // Extract owner username from case ID (if the format is username_filename)\r\n  const ownerUsername = caseId.split('_')[0];\r\n  const isOwner = user.username === ownerUsername;\r\n  const isAdmin = user.role === ROLES.ADMIN;\r\n  const isSuperAdmin = user.role === ROLES.SUPERADMIN;\r\n  \r\n  // Check if the current user can delete this scan\r\n  const canDelete = () => {\r\n    // Superadmin can delete any scan\r\n    if (isSuperAdmin) {\r\n      return true;\r\n    }\r\n    \r\n    // Owner can delete their own scan\r\n    if (isOwner) {\r\n      return true;\r\n    }\r\n    \r\n    // Admin can delete doctors' scans (in a real implementation, you'd check if the admin created the doctor)\r\n    if (isAdmin) {\r\n      return true;\r\n    }\r\n    \r\n    return false;\r\n  };\r\n  \r\n  useEffect(() => {\r\n    const fetchResultDetails = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        const response = await axios.get(`/api/results/${caseId}`);\r\n        setResult(response.data);\r\n        \r\n        // Get the JWT token to use for image access\r\n        const token = localStorage.getItem('token');\r\n        if (token && response.data.image_url) {\r\n          // Ensure the image URL has the correct format and token\r\n          const baseUrl = response.data.image_url.split('?')[0]; // Remove any existing query params\r\n          response.data.image_url = `${baseUrl}?token=${token}`;\r\n          \r\n          // Log success for debugging\r\n          console.log(\"Image URL set with authentication token\");\r\n        }\r\n        \r\n        setIsLoading(false);\r\n      } catch (error) {\r\n        console.error('Error fetching result details:', error);\r\n        \r\n        // Handle 403 Forbidden errors with a specific message\r\n        if (error.response && error.response.status === 403) {\r\n          setError('You do not have permission to view this scan. You can only view scans you have uploaded.');\r\n        } else {\r\n          setError('Failed to load result details. Please try again later.');\r\n        }\r\n        \r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchResultDetails();\r\n  }, [caseId]);\r\n\r\n  // Handle scan deletion\r\n  const handleDeleteScan = async () => {\r\n    try {\r\n      await axios.delete(`/api/results/${caseId}`);\r\n      // Redirect to results page after successful deletion\r\n      navigate('/results', { \r\n        state: { deleteSuccess: `Scan ${caseId} has been deleted successfully.` }\r\n      });\r\n    } catch (error) {\r\n      console.error('Error deleting scan:', error);\r\n      setError('Failed to delete scan. Please try again later.');\r\n      setShowDeleteModal(false);\r\n    }\r\n  };\r\n\r\n  // Handle nodule selection\r\n  const handleNoduleClick = (noduleId) => {\r\n    setSelectedNoduleId(noduleId);\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className={`text-center py-12 ${darkMode ? 'text-white' : ''}`}>\r\n        <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-indigo-600 border-r-transparent\"></div>\r\n        <p className={`mt-4 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Loading result details...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className={`${darkMode ? 'bg-red-900' : 'bg-red-50'} p-4 rounded-md`}>\r\n        <div className=\"flex\">\r\n          <ExclamationCircleIcon className={`h-5 w-5 ${darkMode ? 'text-red-300' : 'text-red-400'}`} aria-hidden=\"true\" />\r\n          <div className=\"ml-3\">\r\n            <h3 className={`text-sm font-medium ${darkMode ? 'text-red-300' : 'text-red-800'}`}>{error}</h3>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!result) {\r\n    return (\r\n      <div className={`text-center py-12 ${darkMode ? 'text-white' : ''}`}>\r\n        <p className={`${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>No result found for this case ID.</p>\r\n        <Link to=\"/results\" className={`mt-4 inline-block ${darkMode ? 'text-indigo-400 hover:text-indigo-300' : 'text-indigo-600 hover:text-indigo-500'}`}>\r\n          Back to all results\r\n        </Link>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Format the timestamp\r\n  const formattedDate = new Date(result.timestamp).toLocaleString();\r\n\r\n  // Parse details if available\r\n  const hasNodules = result.details && !result.details.includes('No nodules detected');\r\n  \r\n  // Extract nodule information if available\r\n  const nodules = [];\r\n  if (hasNodules && result.details) {\r\n    const lines = result.details.split('\\n');\r\n    let currentNodule = null;\r\n    \r\n    for (const line of lines) {\r\n      // Skip segmentation information line\r\n      if (line.includes('Nodule segmentation performed:')) {\r\n        continue;\r\n      }\r\n      \r\n      if (line.startsWith('Nodule ')) {\r\n        if (currentNodule) {\r\n          nodules.push(currentNodule);\r\n        }\r\n        currentNodule = {\r\n          id: line.replace(':', '').trim(),\r\n          coordinates: '',\r\n          radius: '',\r\n          confidence: '',\r\n          merged: ''\r\n        };\r\n      } else if (currentNodule) {\r\n        if (line.includes('Coordinates')) {\r\n          currentNodule.coordinates = line.split(':')[1].trim();\r\n        } else if (line.includes('Radius')) {\r\n          currentNodule.radius = line.split(':')[1].trim();\r\n        } else if (line.includes('Confidence')) {\r\n          currentNodule.confidence = line.split(':')[1].trim();\r\n        } else if (line.includes('Merged from')) {\r\n          currentNodule.merged = line.split(':')[1].trim();\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Add the last nodule\r\n    if (currentNodule) {\r\n      nodules.push(currentNodule);\r\n    }\r\n  }\r\n  \r\n  // Correctly display the count of nodules\r\n  const noduleCount = nodules.length;\r\n  const noduleSummary = hasNodules \r\n    ? `${noduleCount} potential ${noduleCount === 1 ? 'nodule' : 'nodules'} detected in this scan` \r\n    : 'No potential nodules detected in this scan';\r\n\r\n  return (\r\n    <div className={`space-y-6 ${darkMode ? 'text-white' : ''}`}>\r\n      <div className=\"flex justify-between items-center\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          <Link to=\"/results\" className={`${darkMode ? 'text-gray-300 hover:text-gray-100' : 'text-gray-500 hover:text-gray-700'}`}>\r\n            <ArrowLeftIcon className=\"h-5 w-5\" />\r\n          </Link>\r\n          <h1 className={`text-2xl font-semibold ${darkMode ? 'text-white' : 'text-gray-900'}`}>\r\n            Result: {result.case_name}\r\n          </h1>\r\n          \r\n          {/* Ownership indicator */}\r\n          {isAdmin && !isOwner ? (\r\n            <span className={`ml-2 px-3 py-1 inline-flex items-center text-xs font-medium rounded-full ${darkMode ? 'bg-purple-900 text-purple-100' : 'bg-purple-100 text-purple-800'}`}>\r\n              <UserCircleIcon className=\"h-3 w-3 mr-1\" />\r\n              Dr. {ownerUsername}'s scan\r\n            </span>\r\n          ) : (\r\n            <span className={`ml-2 px-3 py-1 inline-flex items-center text-xs font-medium rounded-full ${darkMode ? 'bg-blue-900 text-blue-100' : 'bg-blue-100 text-blue-800'}`}>\r\n              <UserCircleIcon className=\"h-3 w-3 mr-1\" />\r\n              Your scan\r\n            </span>\r\n          )}\r\n        </div>\r\n        <div className=\"flex items-center space-x-4\">\r\n          <span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-500'}`}>\r\n            Processed on {formattedDate}\r\n          </span>\r\n          \r\n          {canDelete() && (\r\n            <button\r\n              onClick={() => setShowDeleteModal(true)}\r\n              className={`px-3 py-1.5 text-sm font-medium flex items-center rounded-md ${\r\n                darkMode \r\n                  ? 'bg-red-900 text-red-100 hover:bg-red-800' \r\n                  : 'bg-red-100 text-red-800 hover:bg-red-200'\r\n              }`}\r\n            >\r\n              <TrashIcon className=\"h-4 w-4 mr-1\" />\r\n              Delete Scan\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Admin viewing notice */}\r\n      {isAdmin && !isOwner && (\r\n        <div className={`${darkMode ? 'bg-yellow-900 border-yellow-700' : 'bg-yellow-50 border-yellow-400'} border-l-4 p-4`}>\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <ExclamationCircleIcon className={`h-5 w-5 ${darkMode ? 'text-yellow-500' : 'text-yellow-400'}`} aria-hidden=\"true\" />\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className={`text-sm ${darkMode ? 'text-yellow-200' : 'text-yellow-700'}`}>\r\n                You are viewing this scan as an administrator. This scan was uploaded by <strong>Dr. {ownerUsername}</strong>.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Interactive Visualization */}\r\n      <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} shadow rounded-lg overflow-hidden`}>\r\n        <div className={`px-4 py-3 border-b ${darkMode ? 'border-gray-700' : 'border-gray-200'} sm:px-6`}>\r\n          <h3 className={`text-lg font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>Interactive Visualization</h3>\r\n        </div>\r\n        <InteractiveViewer \r\n          caseId={caseId} \r\n          selectedNoduleId={selectedNoduleId}\r\n        />\r\n      </div>\r\n\r\n      {/* Result details */}\r\n      <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} shadow rounded-lg overflow-hidden`}>\r\n        <div className={`px-4 py-5 border-b ${darkMode ? 'border-gray-700' : 'border-gray-200'} sm:px-6`}>\r\n          <h3 className={`text-lg font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>Details</h3>\r\n        </div>\r\n        <div className=\"p-6\">\r\n          {/* Patient information section if available */}\r\n          {result.patient_info && (\r\n            <div className={`mb-6 p-4 rounded-md ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>\r\n              <h4 className={`text-md font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2`}>\r\n                Patient Information\r\n              </h4>\r\n              <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\r\n                <div>\r\n                  <p className=\"text-sm font-medium mb-1\">Patient Name:</p>\r\n                  <p>{result.patient_info.name || 'Not provided'}</p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm font-medium mb-1\">Age:</p>\r\n                  <p>{result.patient_info.age || 'Not provided'}</p>\r\n                </div>\r\n                {result.patient_info.description && (\r\n                  <div className=\"col-span-1 md:col-span-2\">\r\n                    <p className=\"text-sm font-medium mb-1\">Clinical Notes:</p>\r\n                    <p className=\"whitespace-pre-wrap\">{result.patient_info.description}</p>\r\n                  </div>\r\n                )}\r\n                <div className=\"col-span-1 md:col-span-2 mt-2\">\r\n                  <p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                    Added by: {result.patient_info.user} on {new Date(result.patient_info.timestamp).toLocaleString()}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {hasNodules ? (\r\n            <div>\r\n              <div className=\"mb-4\">\r\n                <h4 className={`text-md font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>Summary</h4>\r\n                <p className={`${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>\r\n                  {noduleSummary}\r\n                </p>\r\n              </div>\r\n              \r\n              <h4 className={`text-md font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2`}>Detected Nodules</h4>\r\n              <div className=\"overflow-x-auto\">\r\n                <table className={`min-w-full divide-y ${darkMode ? 'divide-gray-700' : 'divide-gray-200'}`}>\r\n                  <thead className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>\r\n                    <tr>\r\n                      <th scope=\"col\" className={`px-6 py-3 text-left text-xs font-medium ${darkMode ? 'text-gray-300' : 'text-gray-500'} uppercase tracking-wider`}>\r\n                        Nodule\r\n                      </th>\r\n                      <th scope=\"col\" className={`px-6 py-3 text-left text-xs font-medium ${darkMode ? 'text-gray-300' : 'text-gray-500'} uppercase tracking-wider`}>\r\n                        Coordinates (z,y,x)\r\n                      </th>\r\n                      <th scope=\"col\" className={`px-6 py-3 text-left text-xs font-medium ${darkMode ? 'text-gray-300' : 'text-gray-500'} uppercase tracking-wider`}>\r\n                        Radius (mm)\r\n                      </th>\r\n                      <th scope=\"col\" className={`px-6 py-3 text-left text-xs font-medium ${darkMode ? 'text-gray-300' : 'text-gray-500'} uppercase tracking-wider`}>\r\n                        Confidence\r\n                      </th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody className={`${darkMode ? 'bg-gray-800 divide-y divide-gray-700' : 'bg-white divide-y divide-gray-200'}`}>\r\n                    {nodules.map((nodule, index) => (\r\n                      <tr \r\n                        key={index} \r\n                        className={`${index % 2 === 0 ? (darkMode ? 'bg-gray-900' : 'bg-gray-50') : ''} \r\n                          cursor-pointer hover:${darkMode ? 'bg-gray-700' : 'bg-gray-100'}`}\r\n                        onClick={() => handleNoduleClick(nodule.id)}\r\n                      >\r\n                        <td className={`px-6 py-4 whitespace-nowrap text-sm ${darkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                          {nodule.id}\r\n                        </td>\r\n                        <td className={`px-6 py-4 whitespace-nowrap text-sm ${darkMode ? 'text-gray-300' : 'text-gray-500'}`}>\r\n                          {nodule.coordinates}\r\n                        </td>\r\n                        <td className={`px-6 py-4 whitespace-nowrap text-sm ${darkMode ? 'text-gray-300' : 'text-gray-500'}`}>\r\n                          {nodule.radius}\r\n                        </td>\r\n                        <td className={`px-6 py-4 whitespace-nowrap text-sm ${darkMode ? 'text-gray-300' : 'text-gray-500'}`}>\r\n                          {nodule.confidence}\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div className={`text-center py-8 ${darkMode ? 'text-gray-300' : 'text-gray-500'}`}>\r\n              <p>No nodules were detected in this scan.</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      {showDeleteModal && (\r\n        <div className=\"fixed z-10 inset-0 overflow-y-auto\">\r\n          <div className=\"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\">\r\n            <div className=\"fixed inset-0 transition-opacity\" aria-hidden=\"true\">\r\n              <div className={`absolute inset-0 ${darkMode ? 'bg-gray-900' : 'bg-gray-500'} opacity-75`}></div>\r\n            </div>\r\n            \r\n            <span className=\"hidden sm:inline-block sm:align-middle sm:h-screen\" aria-hidden=\"true\">&#8203;</span>\r\n            \r\n            <div className={`inline-block align-bottom ${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full`}>\r\n              <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} px-4 pt-5 pb-4 sm:p-6 sm:pb-4`}>\r\n                <div className=\"sm:flex sm:items-start\">\r\n                  <div className={`mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full ${darkMode ? 'bg-red-900' : 'bg-red-100'} sm:mx-0 sm:h-10 sm:w-10`}>\r\n                    <ExclamationCircleIcon className={`h-6 w-6 ${darkMode ? 'text-red-300' : 'text-red-600'}`} aria-hidden=\"true\" />\r\n                  </div>\r\n                  <div className=\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left\">\r\n                    <h3 className={`text-lg leading-6 font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                      Delete Scan\r\n                    </h3>\r\n                    <div className=\"mt-2\">\r\n                      <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-500'}`}>\r\n                        Are you sure you want to delete the scan \"{result.case_name}\"? \r\n                        This action cannot be undone.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className={`${darkMode ? 'bg-gray-800 border-t border-gray-700' : 'bg-gray-50 border-t border-gray-200'} px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse`}>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleDeleteScan}\r\n                  className=\"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm\"\r\n                >\r\n                  Delete\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowDeleteModal(false)}\r\n                  className={`mt-3 w-full inline-flex justify-center rounded-md border shadow-sm px-4 py-2 text-base font-medium focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm ${\r\n                    darkMode \r\n                      ? 'border-gray-600 bg-gray-700 text-gray-300 hover:bg-gray-600' \r\n                      : 'border-gray-300 bg-white text-gray-700 hover:bg-gray-50'\r\n                  }`}\r\n                >\r\n                  Cancel\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResultDetailPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}